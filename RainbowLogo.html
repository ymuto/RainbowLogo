<html>
<head>
<title>ロゴレインボー化</title>
<script src="https://docs.opencv.org/4.0.1/opencv.js"></script>
<script language="JavaScript" type="text/javascript">
function handleFiles(files) {
    console.log(files.size);
    const file = files[0];
    const imageType = /image.*/;
    
    if (file.type.match(imageType)) {
        // Display the given image
        //let sourceImg = document.getElementById("sourceImg");
        //sourceImg.classList.add("obj");
        //sourceImg.file = file;
        
        let reader = new FileReader();
        reader.onload = (
            function(aImg) {
            return function(e) {
                aImg.src = e.target.result;
                console.log("here");
                drawImageInCanvas();

            };
        })(sourceImg);
        reader.readAsDataURL(file);    
    }
}


function drawImageInCanvas() {
    let canvasInput = document.getElementById("canvasInput");
    let canvasContext = canvasInput.getContext('2d');

    var img = new Image();
    img.src = "panasonic_640.jpg";
    img.onload = function () {
        canvasContext.drawImage(img, 0, 0, 200, 200);

        let src = cv.imread("canvasInput");
        let dst = new cv.Mat();
        cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY, 0);
        cv.imshow('canvasOutput', dst);
        src.delete();
        dst.delete();
    };
}
</script>

</head>
<body>
    

<input type="file" id="input" onchange="handleFiles(this.files)" />

<p>sourceImg</p>
<img id="sourceImg" width="200" height="200" style="border: solid 1px black;" />

<p>CanvasInput</p>
<canvas id="canvasInput" width="200" height="200" style="border: solid 1px red;"></canvas>

<p>CanvasOutput</p>
<canvas id="canvasOutput" width="200" height="200" style="border: solid 1px red;"></canvas>


</body>
</html>